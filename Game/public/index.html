<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="99 Idea Puzzle: A multiplayer color merge puzzle game. Play solo or with friends!"
    />
    <title>99 Idea Puzzle - Multiplayer</title>
    <link rel="stylesheet" href="design-tokens.css" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- Main Menu Screen -->
    <section
      id="menu-screen"
      class="screen active"
      role="main"
      aria-label="Main menu"
    >
      <div class="menu-container">
        <header class="menu-header" role="banner">
          <h1 class="game-title">99 Idea Puzzle</h1>
          <h2 class="game-subtitle">Color Merge Challenge</h2>
          <button
            class="btn-icon btn-help"
            id="how-to-play-btn"
            aria-label="Open how to play guide"
          >
            ?
          </button>
        </header>
        <main class="menu-content" id="main-content">
          <fieldset class="player-settings">
            <legend class="visually-hidden">Game Settings</legend>

            <div class="input-group">
              <label for="player-name">Your Name</label>
              <input
                type="text"
                id="player-name"
                placeholder="Enter your name"
                maxlength="20"
                aria-required="true"
              />
            </div>

            <fieldset class="difficulty-section">
              <legend>Select Difficulty</legend>
              <div class="difficulty-grid">
                <label class="difficulty-card" data-level="easy">
                  <input
                    type="radio"
                    name="difficulty"
                    value="easy"
                    data-difficulty="easy"
                    aria-label="Easy difficulty: 5x5 board, 2 balls"
                  />
                  <span class="difficulty-card-body">
                    <span class="difficulty-dot easy" aria-hidden="true"></span>
                    <span class="difficulty-text">
                      <span class="difficulty-name">Easy</span>
                      <span class="difficulty-meta">5x5 board ¬∑ 2 balls</span>
                    </span>
                  </span>
                </label>

                <label class="difficulty-card" data-level="medium">
                  <input
                    type="radio"
                    name="difficulty"
                    value="medium"
                    data-difficulty="medium"
                    aria-label="Medium difficulty: 7x7 board, 3 balls"
                    checked
                  />
                  <span class="difficulty-card-body">
                    <span
                      class="difficulty-dot medium"
                      aria-hidden="true"
                    ></span>
                    <span class="difficulty-text">
                      <span class="difficulty-name">Medium</span>
                      <span class="difficulty-meta">7x7 board ¬∑ 3 balls</span>
                    </span>
                  </span>
                </label>

                <label class="difficulty-card" data-level="hard">
                  <input
                    type="radio"
                    name="difficulty"
                    value="hard"
                    data-difficulty="hard"
                    aria-label="Hard difficulty: 9x9 board, 4 balls"
                  />
                  <span class="difficulty-card-body">
                    <span class="difficulty-dot hard" aria-hidden="true"></span>
                    <span class="difficulty-text">
                      <span class="difficulty-name">Hard</span>
                      <span class="difficulty-meta">9x9 board ¬∑ 4 balls</span>
                    </span>
                  </span>
                </label>

                <label class="difficulty-card" data-level="veryhard">
                  <input
                    type="radio"
                    name="difficulty"
                    value="veryhard"
                    data-difficulty="veryhard"
                    aria-label="Very hard difficulty: 11x11 board, 5 balls"
                  />
                  <span class="difficulty-card-body">
                    <span
                      class="difficulty-dot veryhard"
                      aria-hidden="true"
                    ></span>
                    <span class="difficulty-text">
                      <span class="difficulty-name">Very Hard</span>
                      <span class="difficulty-meta">11x11 board ¬∑ 5 balls</span>
                    </span>
                  </span>
                </label>

                <label class="difficulty-card" data-level="insane">
                  <input
                    type="radio"
                    name="difficulty"
                    value="insane"
                    data-difficulty="insane"
                    aria-label="Insane difficulty: 13x13 board, 6 balls"
                  />
                  <span class="difficulty-card-body">
                    <span
                      class="difficulty-dot insane"
                      aria-hidden="true"
                    ></span>
                    <span class="difficulty-text">
                      <span class="difficulty-name">Insane</span>
                      <span class="difficulty-meta">13x13 board ¬∑ 6 balls</span>
                    </span>
                  </span>
                </label>
              </div>
              <p
                class="difficulty-info"
                id="difficulty-info"
                aria-live="polite"
              >
                Medium: 7x7 board, 3 balls
              </p>
            </fieldset>

            <div class="button-group cta-group">
              <button class="btn btn-success" id="play-solo-btn">
                üéÆ Play Solo
              </button>
              <button class="btn btn-primary" id="create-room-btn">
                Create Room
              </button>
              <button class="btn btn-secondary" id="join-room-btn">
                Join Room
              </button>
            </div>

            <div id="join-room-container" class="join-container hidden">
              <div class="input-group">
                <label for="room-id-input">Room Code</label>
                <input
                  type="text"
                  id="room-id-input"
                  placeholder="Enter 6-digit code"
                  maxlength="6"
                  aria-required="true"
                  aria-describedby="room-code-hint"
                />
                <small id="room-code-hint">Enter a 6-character room code</small>
              </div>
              <button class="btn btn-primary" id="join-room-submit">
                Join
              </button>
              <button class="btn btn-cancel" id="cancel-join-btn">
                Cancel
              </button>
            </div>
          </fieldset>
        </main>
      </div>
    </section>

    <!-- Lobby Screen -->
    <section
      id="lobby-screen"
      class="screen"
      role="main"
      aria-label="Game lobby"
    >
      <div class="lobby-container">
        <header>
          <h2>Game Lobby</h2>
        </header>

        <article class="room-info">
          <div class="room-code-display">
            <span>Room Code:</span>
            <output id="room-code" class="code" aria-label="Current room code"
              >------</output
            >
            <button
              class="btn btn-small"
              id="copy-code-btn"
              aria-label="Copy room code to clipboard"
            >
              üìã Copy
            </button>
          </div>
        </article>

        <section class="players-section" aria-labelledby="players-heading">
          <h3 id="players-heading">
            Players (<span id="player-count" aria-live="polite">0</span>/4)
          </h3>
          <ul id="players-list" class="players-list" role="list"></ul>
        </section>

        <div class="lobby-controls">
          <button class="btn btn-primary" id="ready-btn" aria-pressed="false">
            Ready
          </button>
          <button
            class="btn btn-success"
            id="start-btn"
            style="display: none"
            aria-label="Start the game"
          >
            üöÄ Start Game
          </button>
          <button class="btn btn-cancel" id="leave-room-btn">Leave Room</button>
        </div>

        <div
          id="waiting-message"
          class="waiting-message hidden"
          role="status"
          aria-live="polite"
        >
          All players ready! Waiting for host to start the game...
        </div>
        <div
          id="host-can-start-message"
          class="waiting-message hidden"
          role="status"
          aria-live="polite"
          style="color: #4caf50"
        >
          All players ready! Click Start Game to begin the race.
        </div>
      </div>
    </section>

    <!-- Game Screen -->
    <section
      id="game-screen"
      class="screen"
      role="main"
      aria-label="Game play area"
    >
      <div class="game-container">
        <header class="game-header">
          <div class="header-top">
            <div class="header-left">
              <h2>99 Idea Puzzle</h2>
              <div
                class="turn-indicator"
                id="current-turn"
                role="status"
                aria-live="polite"
                aria-atomic="true"
              >
                Waiting...
              </div>
            </div>
            <div class="header-right">
              <section
                id="solo-stats"
                class="solo-stats"
                style="display: none"
                aria-labelledby="solo-stats-heading"
              >
                <h3 id="solo-stats-heading" class="visually-hidden">
                  Game Statistics
                </h3>
                <div class="stat-item">
                  <span class="stat-label">Score:</span>
                  <output id="solo-score" aria-label="Current score">0</output>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Moves:</span>
                  <output id="solo-moves" aria-label="Number of moves"
                    >0</output
                  >
                </div>
              </section>
              <button
                class="btn-icon btn-help"
                id="game-instructions-btn"
                aria-label="Open game instructions"
              >
                ?
              </button>
            </div>
          </div>
        </header>

        <div class="game-layout">
          <div class="game-main-content">
            <!-- Scores Sidebar (Top on Mobile) -->
            <aside class="scores-sidebar" aria-labelledby="scores-heading">
              <article class="scores-panel">
                <h3 id="scores-heading">Scores</h3>
                <ul id="scores-list" class="scores-list" role="list"></ul>
              </article>
            </aside>

            <!-- Game Board & Controls -->
            <section
              class="game-board-section"
              role="region"
              aria-labelledby="board-heading"
            >
              <h2 id="board-heading" class="visually-hidden">Game Board</h2>

              <div class="board-wrapper">
                <div
                  id="board"
                  class="board"
                  role="img"
                  aria-label="Interactive game board with colored balls and targets"
                ></div>
              </div>

              <!-- Controls Section -->
              <section class="game-controls" aria-labelledby="controls-heading">
                <h3 id="controls-heading" class="visually-hidden">
                  Game Controls
                </h3>

                <!-- Direction Pad -->
                <div class="direction-pad">
                  <button
                    class="btn-control"
                    id="btn-up"
                    aria-label="Move balls up"
                  >
                    ‚Üë
                  </button>
                  <div
                    class="horizontal-controls"
                    role="group"
                    aria-label="Left, down, right directions"
                  >
                    <button
                      class="btn-control"
                      id="btn-left"
                      aria-label="Move balls left"
                    >
                      ‚Üê
                    </button>
                    <button
                      class="btn-control"
                      id="btn-down"
                      aria-label="Move balls down"
                    >
                      ‚Üì
                    </button>
                    <button
                      class="btn-control"
                      id="btn-right"
                      aria-label="Move balls right"
                    >
                      ‚Üí
                    </button>
                  </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons-wrapper">
                  <button
                    class="btn btn-hint"
                    id="hint-btn"
                    aria-label="Get AI hint for next move"
                  >
                    üí° Hint
                  </button>
                  <button
                    class="btn btn-success"
                    id="set-btn"
                    aria-label="Submit solution - activates when all balls are adjacent to targets"
                  >
                    SET
                  </button>
                  <button
                    class="btn btn-secondary"
                    id="new-round-btn"
                    aria-label="Start a new puzzle round"
                  >
                    New Round
                  </button>
                  <button
                    class="btn btn-cancel"
                    id="quit-solo-btn"
                    style="display: none"
                    aria-label="Return to main menu"
                  >
                    üè† Menu
                  </button>
                </div>

                <!-- Hint Message -->
                <div
                  id="hint-message"
                  class="hint-message hidden"
                  role="status"
                  aria-live="polite"
                  aria-atomic="true"
                ></div>
              </section>
            </section>
          </div>
        </div>
      </div>
    </section>

    <!-- Notification Toast -->
    <div
      id="notification"
      class="notification"
      role="status"
      aria-live="polite"
      aria-atomic="true"
    ></div>

    <!-- Leaderboard Modal -->
    <dialog id="leaderboard-modal" class="modal hidden">
      <article class="modal-content">
        <header class="modal-header">
          <h2>Leaderboard</h2>
          <button
            id="leaderboard-close"
            class="btn-close"
            aria-label="Close leaderboard"
          >
            ‚úñ
          </button>
        </header>
        <section class="modal-body">
          <ul id="leaderboard-list" class="leaderboard-list" role="list"></ul>
        </section>
        <footer class="modal-footer">
          <button id="leaderboard-close-btn" class="btn btn-primary">
            Close
          </button>
        </footer>
      </article>
    </dialog>

    <!-- Game Instructions Modal (In-Game) -->
    <dialog id="game-instructions-modal" class="modal hidden">
      <article class="modal-content modal-large">
        <header class="modal-header">
          <h2>How to Play</h2>
          <button
            id="game-instructions-close"
            class="btn-close"
            aria-label="Close instructions"
          >
            ‚úñ
          </button>
        </header>
        <section class="modal-body">
          <ul class="instructions" role="list">
            <li>Move colored balls using arrow buttons</li>
            <li>Position balls next to their matching targets</li>
            <li>Press SET when all balls are adjacent to targets</li>
            <li id="multiplayer-tip">Take turns with other players</li>
            <li id="solo-tip" style="display: none">
              Solve puzzles at your own pace!
            </li>
            <li>Complete rounds to earn points!</li>
            <li><strong>üí° Click Hint</strong> for help solving the puzzle</li>
          </ul>
        </section>
        <footer class="modal-footer">
          <button
            id="game-instructions-close-btn"
            class="btn btn-primary"
            aria-label="Close this dialog"
          >
            Got it!
          </button>
        </footer>
      </article>
    </dialog>

    <!-- How to Play Modal -->
    <dialog id="how-to-play-modal" class="modal hidden">
      <article class="modal-content modal-large">
        <header class="modal-header">
          <h2>How to Play</h2>
          <button
            id="how-to-play-close"
            class="btn-close"
            aria-label="Close how to play guide"
          >
            ‚úñ
          </button>
        </header>
        <section class="modal-body">
          <section class="tutorial-section" aria-labelledby="objective-heading">
            <h3 id="objective-heading">üéÆ Objective</h3>
            <p>
              Move colored balls on the grid to match them with their target
              positions. Complete puzzles and earn points!
            </p>
          </section>

          <section class="tutorial-section" aria-labelledby="controls-heading">
            <h3 id="controls-heading">üéØ Basic Controls</h3>
            <ul class="tutorial-list" role="list">
              <li>
                <strong>Arrow Keys or Buttons:</strong> Move all balls in that
                direction
              </li>
              <li>
                <strong>SET Button:</strong> Submit your solution when all balls
                are adjacent to targets
              </li>
              <li>
                <strong>üí° Hint:</strong> Get AI suggestion for the next move
              </li>
            </ul>
          </section>

          <section class="tutorial-section" aria-labelledby="modes-heading">
            <h3 id="modes-heading">üé≤ Game Modes</h3>
            <ul class="tutorial-list" role="list">
              <li>
                <strong>Solo:</strong> Practice at your own pace with increasing
                difficulty
              </li>
              <li>
                <strong>Multiplayer:</strong> Race against friends in real-time
                or take turns
              </li>
              <li>
                <strong>Difficulty Levels:</strong> Easy (5x5) ‚Üí Hard (9x9) ‚Üí
                Insane (13x13)
              </li>
            </ul>
          </section>

          <section class="tutorial-section" aria-labelledby="rules-heading">
            <h3 id="rules-heading">‚≠ê Rules</h3>
            <ul class="tutorial-list" role="list">
              <li>All balls move together in the same direction</li>
              <li>Balls stop at grid edges or when blocked</li>
              <li>
                Each ball must be <strong>adjacent (touching)</strong> its
                target to set
              </li>
              <li>Complete rounds to unlock higher scores</li>
            </ul>
          </section>

          <section class="tutorial-section" aria-labelledby="tips-heading">
            <h3 id="tips-heading">üí° Tips & Tricks</h3>
            <ul class="tutorial-list" role="list">
              <li>Plan your moves before executing them</li>
              <li>Use the Hint button when stuck</li>
              <li>In multiplayer, watch other players' strategies</li>
              <li>Green highlight shows where balls can move</li>
            </ul>
          </section>
        </section>
        <footer class="modal-footer">
          <button
            id="how-to-play-close-btn"
            class="btn btn-primary"
            aria-label="Close this dialog"
          >
            Got it!
          </button>
        </footer>
      </article>
    </dialog>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="../game-logic.js"></script>
    <script src="client.js"></script>
  </body>
</html>
